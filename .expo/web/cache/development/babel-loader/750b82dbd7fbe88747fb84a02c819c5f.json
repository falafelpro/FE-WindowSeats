{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { makeAutoObservable } from \"mobx\";\nimport decode from \"jwt-decode\";\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\nimport { instance } from \"./instance\";\n\nvar AuthStore = function AuthStore() {\n  var _this = this;\n\n  _classCallCheck(this, AuthStore);\n\n  this.user = null;\n\n  this.setUser = function _callee(token) {\n    return _regeneratorRuntime.async(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.prev = 0;\n            _context.next = 3;\n            return _regeneratorRuntime.awrap(AsyncStorage.setItem(\"myToken\", token));\n\n          case 3:\n            instance.defaults.headers.common.Authorization = \"Bearer \" + token;\n            _this.user = decode(token);\n            _context.next = 10;\n            break;\n\n          case 7:\n            _context.prev = 7;\n            _context.t0 = _context[\"catch\"](0);\n            console.log(_context.t0);\n\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, [[0, 7]], Promise);\n  };\n\n  this.signup = function _callee2(user, navigation) {\n    var response;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signup\", user));\n\n          case 3:\n            response = _context2.sent;\n\n            _this.setUser(response.data.token);\n\n            navigation.navigate(\"ProfileList\");\n            console.log(\"authStore -> signup -> response.data\", response.data);\n            _context2.next = 12;\n            break;\n\n          case 9:\n            _context2.prev = 9;\n            _context2.t0 = _context2[\"catch\"](0);\n            console.log(\"AuthStore -> signup -> error\", _context2.t0);\n\n          case 12:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  this.signin = function _callee3(user, navigation) {\n    var response;\n    return _regeneratorRuntime.async(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.prev = 0;\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(instance.post(\"/signin\", user));\n\n          case 3:\n            response = _context3.sent;\n\n            _this.setUser(response.data.token);\n\n            navigation.navigate(\"TripList\");\n            console.log(\"authStore -> signin -> response.data\", response.data);\n            _context3.next = 12;\n            break;\n\n          case 9:\n            _context3.prev = 9;\n            _context3.t0 = _context3[\"catch\"](0);\n            console.log(\"AuthStore -> signin -> error\", _context3.t0);\n\n          case 12:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, [[0, 9]], Promise);\n  };\n\n  this.logout = function _callee4(navigation) {\n    return _regeneratorRuntime.async(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n            delete instance.defaults.headers.common.Authorization;\n            _context4.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.removeItem(\"myToken\"));\n\n          case 4:\n            _this.user = null;\n            navigation.navigate(\"Signin\");\n            _context4.next = 11;\n            break;\n\n          case 8:\n            _context4.prev = 8;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n\n          case 11:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 8]], Promise);\n  };\n\n  this.checkForToken = function _callee5() {\n    var token, currentTime, tempUser;\n    return _regeneratorRuntime.async(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _this.user = null;\n            _context5.prev = 1;\n            _context5.next = 4;\n            return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"myToken\"));\n\n          case 4:\n            token = _context5.sent;\n\n            if (token) {\n              currentTime = Date.now();\n              tempUser = decode(token);\n\n              if (tempUser.exp >= currentTime) {\n                _this.setUser(token);\n              } else {\n                _this.logout();\n              }\n            }\n\n            _context5.next = 11;\n            break;\n\n          case 8:\n            _context5.prev = 8;\n            _context5.t0 = _context5[\"catch\"](1);\n            console.log(_context5.t0);\n\n          case 11:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, [[1, 8]], Promise);\n  };\n\n  makeAutoObservable(this);\n};\n\nvar authStore = new AuthStore();\nauthStore.checkForToken();\nexport default authStore;","map":{"version":3,"sources":["C:/Users/hussa/Development/ReactNative/FE-WindowSeats/Stores/authStore.js"],"names":["makeAutoObservable","decode","AsyncStorage","instance","AuthStore","user","setUser","token","setItem","defaults","headers","common","Authorization","console","log","signup","navigation","post","response","data","navigate","signin","logout","removeItem","checkForToken","getItem","currentTime","Date","now","tempUser","exp","authStore"],"mappings":"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","sourcesContent":["import { makeAutoObservable } from \"mobx\";\r\nimport decode from \"jwt-decode\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { instance } from \"./instance\";\r\n\r\nclass AuthStore {\r\n  user = null;\r\n\r\n  constructor() {\r\n    makeAutoObservable(this);\r\n  }\r\n\r\n  setUser = async (token) => {\r\n    try {\r\n      await AsyncStorage.setItem(\"myToken\", token);\r\n      instance.defaults.headers.common.Authorization = `Bearer ${token}`;\r\n      this.user = decode(token);\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  signup = async (user, navigation) => {\r\n    try {\r\n      const response = await instance.post(\"/signup\", user);\r\n      this.setUser(response.data.token);\r\n      navigation.navigate(\"ProfileList\");\r\n      console.log(\"authStore -> signup -> response.data\", response.data);\r\n    } catch (error) {\r\n      console.log(\"AuthStore -> signup -> error\", error);\r\n    }\r\n  };\r\n\r\n  signin = async (user, navigation) => {\r\n    try {\r\n      const response = await instance.post(\"/signin\", user);\r\n      this.setUser(response.data.token);\r\n      navigation.navigate(\"TripList\");\r\n      console.log(\"authStore -> signin -> response.data\", response.data);\r\n    } catch (error) {\r\n      console.log(\"AuthStore -> signin -> error\", error);\r\n    }\r\n  };\r\n\r\n  logout = async (navigation) => {\r\n    try {\r\n      delete instance.defaults.headers.common.Authorization;\r\n      await AsyncStorage.removeItem(\"myToken\");\r\n      this.user = null;\r\n      navigation.navigate(\"Signin\");\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n\r\n  checkForToken = async () => {\r\n    this.user = null;\r\n    try {\r\n      const token = await AsyncStorage.getItem(\"myToken\");\r\n      if (token) {\r\n        const currentTime = Date.now(); // give us the current time\r\n        const tempUser = decode(token);\r\n        if (tempUser.exp >= currentTime) {\r\n          this.setUser(token);\r\n        } else {\r\n          this.logout();\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.log(error);\r\n    }\r\n  };\r\n}\r\n\r\nconst authStore = new AuthStore();\r\nauthStore.checkForToken();\r\nexport default authStore;\r\n"]},"metadata":{},"sourceType":"module"}